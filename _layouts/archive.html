---
layout: default
---

{%- comment -%}
  Enhanced Archive with Search
  - Real-time search filtering (progressive enhancement)
  - Year grouping with collapsible sections
  - Result counter
  - Keyboard shortcut (/)
  - Empty state handling
{%- endcomment -%}

<section class="archive-page" aria-label="Post archive">
    <header class="archive-header">
        <h1 id="archive-title">{{ page.title }}</h1>
        {%- if page.description -%}
        <p class="archive-description">{{ page.description }}</p>
        {%- endif -%}
        <p class="archive-stats">
            <span class="stat-total">{{ site.posts | size }}</span> articles published since {{ site.posts | last | map: 'date' | first | date: "%Y" }}
        </p>
    </header>

    <!-- Search Box -->
    <div class="archive-search" role="search">
        <label for="archive-search-input" class="sr-only">Search articles</label>
        <input type="search"
               id="archive-search-input"
               class="archive-search-input"
               placeholder="üîç Search articles..."
               aria-label="Search articles"
               aria-describedby="search-hint"
               autocomplete="off">
        <span class="search-hint" id="search-hint" aria-hidden="true">
            <kbd>/</kbd> to focus
        </span>
        <button type="button" class="search-clear" id="search-clear" hidden aria-label="Clear search">
            ‚úï
        </button>
    </div>

    <!-- Result Counter -->
    <div class="archive-results" aria-live="polite" aria-atomic="true">
        <span id="results-count">Showing all {{ site.posts | size }} articles</span>
    </div>

    {{ content }}

    <!-- Posts by Year -->
    <div class="archive-years" id="archive-list">
        {%- assign posts_by_year = site.posts | group_by_exp: "post", "post.date | date: '%Y'" -%}
        {%- for year in posts_by_year -%}
        <details class="year-group" open data-year="{{ year.name }}">
            <summary class="year-header">
                <span class="year-chevron" aria-hidden="true"></span>
                <span class="year-label">{{ year.name }}</span>
                <span class="year-count" data-original="{{ year.items | size }}">{{ year.items | size }} articles</span>
            </summary>
            <ul class="archive-posts" role="list">
                {%- for post in year.items -%}
                <li class="archive-post-item"
                    role="listitem"
                    data-searchable="{{ post.title | downcase }} {{ post.tags | join: ' ' | downcase }} {{ post.category | downcase }}">
                    <time class="archive-date" datetime="{{ post.date | date_to_xmlschema }}">
                        {{ post.date | date: "%d %b" }}
                    </time>
                    <a class="archive-link" href="{{ post.url | relative_url }}">
                        {{ post.title }}
                    </a>
                    {%- if post.tags.size > 0 -%}
                    <span class="archive-tags" aria-label="Tags">
                        {%- for tag in post.tags limit: 2 -%}
                        <span class="archive-tag">{{ tag }}</span>
                        {%- endfor -%}
                    </span>
                    {%- endif -%}
                </li>
                {%- endfor -%}
            </ul>
        </details>
        {%- endfor -%}
    </div>

    <!-- Empty State -->
    <div class="archive-empty" id="no-results" hidden aria-hidden="true">
        <div class="empty-icon" aria-hidden="true">üîç</div>
        <p>No articles found matching "<strong id="search-term"></strong>"</p>
        <p class="empty-hint">Try different keywords or <button type="button" class="clear-link" id="clear-search">clear the search</button></p>
    </div>
</section>

<style>
/* ============================================
   ARCHIVE PAGE - Enhanced Search
   ============================================ */

.archive-page {
    max-width: 800px;
    margin: 0 auto;
}

/* Header */
.archive-header {
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid var(--border-color, #e5e7eb);
    text-align: center;
}

.archive-header h1 {
    margin-bottom: 0.5rem;
    font-size: 2rem;
}

.archive-description {
    color: var(--text-secondary, #6b7280);
    margin-bottom: 0.5rem;
    font-size: 1.05rem;
}

.archive-stats {
    font-size: 0.9rem;
    color: var(--text-secondary, #6b7280);
}

.stat-total {
    font-weight: 700;
    color: var(--link-color, #0066cc);
    font-size: 1.1em;
}

/* Search Box */
.archive-search {
    position: relative;
    margin-bottom: 1rem;
}

.archive-search-input {
    width: 100%;
    padding: 1rem 3.5rem 1rem 1.25rem;
    font-size: 1rem;
    border: 2px solid var(--border-color, #e5e7eb);
    border-radius: 12px;
    background: var(--bg-color, #fff);
    color: var(--text-color, #1a1a1a);
    transition: border-color 0.2s, box-shadow 0.2s;
}

.archive-search-input:focus {
    outline: none;
    border-color: var(--link-color, #0066cc);
    box-shadow: 0 0 0 4px rgba(0, 102, 204, 0.12);
}

.archive-search-input::placeholder {
    color: var(--text-secondary, #9ca3af);
}

.search-hint {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    font-size: 0.75rem;
    color: var(--text-secondary, #9ca3af);
    pointer-events: none;
    transition: opacity 0.2s;
}

.archive-search-input:focus ~ .search-hint,
.archive-search-input:not(:placeholder-shown) ~ .search-hint {
    opacity: 0;
}

.search-hint kbd {
    display: inline-block;
    padding: 0.2rem 0.5rem;
    font-family: ui-monospace, monospace;
    font-size: 0.7rem;
    background: var(--code-bg, #f5f5f5);
    border: 1px solid var(--border-color, #d1d5db);
    border-radius: 4px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
}

.search-clear {
    position: absolute;
    right: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    width: 28px;
    height: 28px;
    border: none;
    background: var(--code-bg, #f3f4f6);
    color: var(--text-secondary, #6b7280);
    border-radius: 50%;
    cursor: pointer;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s, color 0.2s;
}

.search-clear:hover {
    background: var(--border-color, #e5e7eb);
    color: var(--text-color, #1a1a1a);
}

.search-clear[hidden] {
    display: none;
}

/* Result Counter */
.archive-results {
    margin-bottom: 1.5rem;
    font-size: 0.9rem;
    color: var(--text-secondary, #6b7280);
    text-align: center;
}

#results-count strong {
    color: var(--link-color, #0066cc);
}

/* Year Groups */
.archive-years {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.year-group {
    border: 1px solid var(--border-color, #e5e7eb);
    border-radius: 12px;
    overflow: hidden;
    transition: opacity 0.2s;
}

.year-group[hidden] {
    display: none;
}

.year-group.dimmed {
    opacity: 0.5;
}

.year-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 1.25rem;
    background: linear-gradient(to right, var(--code-bg, #f8fafc), transparent);
    cursor: pointer;
    font-weight: 600;
    list-style: none;
    user-select: none;
    transition: background 0.2s;
}

.year-header:hover {
    background: var(--code-bg, #f0f4f8);
}

.year-header::-webkit-details-marker {
    display: none;
}

.year-chevron {
    width: 0;
    height: 0;
    border-left: 5px solid var(--text-secondary, #6b7280);
    border-top: 4px solid transparent;
    border-bottom: 4px solid transparent;
    transition: transform 0.2s ease;
}

details[open] .year-chevron {
    transform: rotate(90deg);
}

.year-label {
    font-size: 1.15rem;
    color: var(--text-color, #1a1a1a);
    flex: 1;
}

.year-count {
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--text-secondary, #6b7280);
    background: var(--bg-color, #fff);
    padding: 0.3rem 0.75rem;
    border-radius: 2rem;
    border: 1px solid var(--border-color, #e5e7eb);
}

/* Post List */
.archive-posts {
    list-style: none;
    margin: 0;
    padding: 0;
}

.archive-post-item {
    display: flex;
    align-items: baseline;
    gap: 1rem;
    padding: 0.875rem 1.25rem;
    border-top: 1px solid var(--border-color, #e5e7eb);
    transition: background-color 0.15s;
}

.archive-post-item:hover {
    background: rgba(0, 102, 204, 0.03);
}

.archive-post-item[hidden] {
    display: none;
}

.archive-date {
    flex-shrink: 0;
    min-width: 3.5rem;
    font-size: 0.8rem;
    font-family: ui-monospace, monospace;
    color: var(--text-secondary, #9ca3af);
}

.archive-link {
    flex: 1;
    color: var(--text-color, #1a1a1a);
    text-decoration: none;
    font-weight: 500;
    line-height: 1.4;
}

.archive-link:hover {
    color: var(--link-color, #0066cc);
}

.archive-tags {
    display: flex;
    gap: 0.35rem;
    flex-shrink: 0;
}

.archive-tag {
    font-size: 0.7rem;
    padding: 0.15rem 0.5rem;
    background: var(--code-bg, #f3f4f6);
    color: var(--text-secondary, #6b7280);
    border-radius: 3px;
}

/* Empty State */
.archive-empty {
    text-align: center;
    padding: 4rem 1rem;
    color: var(--text-secondary, #6b7280);
}

.archive-empty[hidden] {
    display: none;
}

.empty-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
}

.archive-empty p {
    margin: 0.5rem 0;
}

.archive-empty strong {
    color: var(--text-color, #1a1a1a);
}

.empty-hint {
    font-size: 0.9rem;
}

.clear-link {
    background: none;
    border: none;
    color: var(--link-color, #0066cc);
    cursor: pointer;
    text-decoration: underline;
    font: inherit;
}

/* Accessibility */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    border: 0;
}

/* Dark Mode */
.dark-theme .archive-search-input {
    background: var(--bg-color);
    border-color: var(--border-color);
}

.dark-theme .year-header {
    background: linear-gradient(to right, var(--code-bg), transparent);
}

.dark-theme .year-count {
    background: var(--bg-color);
    border-color: var(--border-color);
}

.dark-theme .archive-post-item:hover {
    background: rgba(88, 166, 255, 0.05);
}

.dark-theme .archive-tag {
    background: var(--code-bg);
}

/* Responsive */
@media (max-width: 640px) {
    .archive-header h1 {
        font-size: 1.5rem;
    }

    .archive-post-item {
        flex-wrap: wrap;
        gap: 0.25rem;
        padding: 0.75rem 1rem;
    }

    .archive-date {
        order: 1;
    }

    .archive-link {
        order: 2;
        width: calc(100% - 4rem);
    }

    .archive-tags {
        order: 3;
        width: 100%;
        margin-top: 0.25rem;
    }

    .search-hint {
        display: none;
    }
}

/* Reduced Motion */
@media (prefers-reduced-motion: reduce) {
    .year-chevron,
    .archive-search-input,
    .archive-post-item,
    .year-group,
    .search-hint {
        transition: none;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.getElementById('archive-search-input');
    const searchClear = document.getElementById('search-clear');
    const resultsCount = document.getElementById('results-count');
    const noResults = document.getElementById('no-results');
    const searchTerm = document.getElementById('search-term');
    const clearSearch = document.getElementById('clear-search');
    const yearGroups = document.querySelectorAll('.year-group');
    const totalPosts = {{ site.posts | size }};

    function performSearch() {
        const query = searchInput.value.toLowerCase().trim();
        let visibleCount = 0;

        // Show/hide clear button
        searchClear.hidden = !query;

        yearGroups.forEach(group => {
            const posts = group.querySelectorAll('.archive-post-item');
            let yearVisible = 0;

            posts.forEach(post => {
                const searchable = post.dataset.searchable || '';
                const matches = !query || searchable.includes(query);
                post.hidden = !matches;
                if (matches) {
                    visibleCount++;
                    yearVisible++;
                }
            });

            // Update year count
            const countEl = group.querySelector('.year-count');
            if (countEl) {
                const original = countEl.dataset.original;
                countEl.textContent = query
                    ? `${yearVisible} of ${original}`
                    : `${original} articles`;
            }

            // Hide empty year groups
            group.hidden = yearVisible === 0 && query;
        });

        // Update results counter
        if (!query) {
            resultsCount.innerHTML = `Showing all <strong>${totalPosts}</strong> articles`;
        } else if (visibleCount === 0) {
            resultsCount.innerHTML = `No articles found`;
        } else {
            resultsCount.innerHTML = `Found <strong>${visibleCount}</strong> of ${totalPosts} articles`;
        }

        // Show/hide empty state
        noResults.hidden = visibleCount > 0 || !query;
        noResults.setAttribute('aria-hidden', visibleCount > 0 || !query);
        if (searchTerm) searchTerm.textContent = query;

        // Show/hide archive list
        document.getElementById('archive-list').hidden = visibleCount === 0 && query;
    }

    // Debounced search
    let debounceTimer;
    searchInput.addEventListener('input', function() {
        clearTimeout(debounceTimer);
        debounceTimer = setTimeout(performSearch, 150);
    });

    // Clear button
    searchClear.addEventListener('click', function() {
        searchInput.value = '';
        performSearch();
        searchInput.focus();
    });

    // Clear link in empty state
    if (clearSearch) {
        clearSearch.addEventListener('click', function() {
            searchInput.value = '';
            performSearch();
            searchInput.focus();
        });
    }

    // Keyboard shortcut: / to focus search
    document.addEventListener('keydown', function(e) {
        if (e.key === '/' && !['INPUT', 'TEXTAREA'].includes(document.activeElement.tagName)) {
            e.preventDefault();
            searchInput.focus();
        }
        if (e.key === 'Escape' && document.activeElement === searchInput) {
            searchInput.blur();
            if (searchInput.value) {
                searchInput.value = '';
                performSearch();
            }
        }
    });
});
</script>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "{{ page.title }}",
  "description": "{{ page.description | default: 'Browse all blog posts' }}",
  "url": "{{ page.url | absolute_url }}",
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": {{ site.posts | size }},
    "itemListElement": [
      {%- for post in site.posts limit:10 -%}
      {
        "@type": "ListItem",
        "position": {{ forloop.index }},
        "url": "{{ post.url | absolute_url }}",
        "name": "{{ post.title | escape }}"
      }{%- unless forloop.last -%},{%- endunless -%}
      {%- endfor -%}
    ]
  },
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {"@type": "ListItem", "position": 1, "name": "Home", "item": "{{ '/' | absolute_url }}"},
      {"@type": "ListItem", "position": 2, "name": "{{ page.title }}"}
    ]
  }
}
</script>
