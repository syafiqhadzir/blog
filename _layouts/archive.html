---
layout: default
---
{%- comment -%}
================================================================================
ENHANCED ARCHIVE WITH SEARCH (AMP-COMPLIANT)
Features:
  1. Real-time search filtering with debounced input
  2. Live result counter with match count
  3. Year grouping with collapsible sections
  4. Progressive disclosure (load more years)
  5. Keyboard shortcut (/) to focus
  6. Enhanced accessibility (aria-live, aria-busy)
  7. Empty state handling
================================================================================
{%- endcomment -%}

{%- assign total_posts = site.posts | size -%}
{%- assign posts_by_year = site.posts | group_by_exp: "post", "post.date | date: '%Y'" -%}
{%- assign initial_years = 3 -%}

<section class="archive-page" aria-label="Post archive">
    <header class="archive-header">
        <h1 id="archive-title">{{ page.title }}</h1>
        {%- if page.description -%}
        <p class="archive-description">{{ page.description }}</p>
        {%- endif -%}
        <p class="archive-stats">
            <span class="stat-total">{{ total_posts }}</span> articles published since 2022.
        </p>
    </header>

    {%- comment -%} Enhanced Search Box {%- endcomment -%}
    <div class="archive-search" role="search">
        <label for="archive-search-input" class="sr-only">Search articles</label>
        <span class="search-icon" aria-hidden="true">üîç</span>
        <input type="search"
               id="archive-search-input"
               class="archive-search-input has-icon"
               placeholder="Search articles..."
               aria-label="Search articles"
               aria-describedby="search-hint"
               aria-controls="archive-list"
               on="input-debounced:AMP.setState({ archiveQuery: event.value.toLowerCase().trim() })"
               [value]="archiveQuery || ''"
               autocomplete="off">
        <span class="search-hint" id="search-hint" aria-hidden="true" [hidden]="archiveQuery">
            <kbd>/</kbd> to focus
        </span>
    </div>

    {%- comment -%} Live Result Counter {%- endcomment -%}
    <div class="archive-results"
         role="status"
         aria-live="polite"
         aria-atomic="true"
         [hidden]="!archiveQuery"
         [aria-busy]="false">
        <span class="results-text">
            Searching for "<strong [text]="archiveQuery"></strong>"
        </span>
    </div>

    {{ content }}

    {%- comment -%} AMP State for Progressive Disclosure {%- endcomment -%}
    <amp-state id="showAllYears">
        <script type="application/json">
            false
        </script>
    </amp-state>

    {%- comment -%} Posts by Year {%- endcomment -%}
    <div class="archive-years" id="archive-list">
        {%- for year in posts_by_year -%}
        {%- assign year_index = forloop.index0 -%}
        {%- comment -%} Pre-compute searchable content for this year {%- endcomment -%}
        {%- capture year_searchable -%}
            {%- for post in year.items -%}
                {{ post.title | downcase | replace: "'", "" | replace: '"', "" }} {{ post.tags | join: ' ' | downcase }}
            {%- endfor -%}
        {%- endcapture -%}
        {%- assign year_searchable_clean = year_searchable | strip_newlines | strip -%}
        <details class="year-group" {% if year_index < initial_years %}open{% endif %}
                 data-year="{{ year.name }}"
                 data-year-index="{{ year_index }}"
                 {% if year_index >= initial_years %}hidden{% endif %}
                 [hidden]="({{ year_index }} >= {{ initial_years }} && !showAllYears && !archiveQuery) || (archiveQuery && archiveQuery.length > 0 && '{{ year_searchable_clean }}'.indexOf(archiveQuery) === -1)">
            <summary class="year-header">
                <span class="year-chevron" aria-hidden="true"></span>
                <span class="year-label">{{ year.name }}</span>
                <span class="year-count" data-original="{{ year.items | size }}">{{ year.items | size }} articles</span>
            </summary>
            <ul class="archive-posts" role="list">
                {%- for post in year.items -%}
                {%- assign post_searchable = post.title | downcase | append: ' ' | append: post.tags | join: ' ' | downcase -%}
                <li class="archive-post-item"
                    role="listitem"
                    data-searchable="{{ post_searchable | replace: "'", "" | replace: '"', "" }}"
                    [hidden]="archiveQuery && archiveQuery.length > 0 && '{{ post_searchable | replace: "'", "" | replace: '"', "" }}'.indexOf(archiveQuery) === -1"
                    [class]="archiveQuery && archiveQuery.length > 0 && '{{ post_searchable | replace: "'", "" | replace: '"', "" }}'.indexOf(archiveQuery) !== -1 ? 'archive-post-item is-matched' : 'archive-post-item'">
                    <time class="archive-date" datetime="{{ post.date | date_to_xmlschema }}">
                        {{ post.date | date: "%d %b" }}
                    </time>
                    <a class="archive-link" href="{{ post.url | relative_url }}">
                        {{ post.title }}
                    </a>
                    {%- if post.tags.size > 0 -%}
                    <span class="archive-tags">
                        {%- for tag in post.tags limit: 2 -%}
                        <span class="archive-tag">{{ tag }}</span>
                        {%- endfor -%}
                    </span>
                    {%- endif -%}
                </li>
                {%- endfor -%}
            </ul>
        </details>
        {%- endfor -%}

        {%- if posts_by_year.size > initial_years -%}
        <div class="archive-load-more" [hidden]="showAllYears || archiveQuery">
            <button type="button"
                    class="load-more-years"
                    on="tap:AMP.setState({ showAllYears: true })">
                Load {{ posts_by_year.size | minus: initial_years }} more years
            </button>
        </div>
        {%- endif -%}
    </div>

    {%- comment -%} Empty State {%- endcomment -%}
    {%- capture all_posts_searchable -%}
        {%- for post in site.posts -%}
            {{ post.title | downcase }} {{ post.tags | join: ' ' | downcase }}
        {%- endfor -%}
    {%- endcapture -%}
    {%- assign all_searchable_clean = all_posts_searchable | strip_newlines | strip | replace: "'", "" | replace: '"', "" -%}
    <div class="archive-empty"
         id="no-results"
         role="alert"
         [hidden]="!archiveQuery || archiveQuery.length === 0 || '{{ all_searchable_clean }}'.indexOf(archiveQuery) !== -1">
        <div class="empty-icon" aria-hidden="true">üîç</div>
        <p>No articles found matching "<strong [text]="archiveQuery"></strong>"</p>
        <p class="empty-hint">Try different keywords or <button type="button" class="clear-link" on="tap:AMP.setState({ archiveQuery: '' })">clear the search</button></p>
    </div>
</section>

{%- comment -%}
================================================================================
SCHEMA.ORG JSON-LD
================================================================================
{%- endcomment -%}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "{{ page.title }}",
  "description": "{{ page.description | default: 'Browse all blog posts' }}",
  "url": "{{ page.url | absolute_url }}",
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": {{ total_posts }},
    "itemListElement": [
      {%- for post in site.posts limit:10 -%}
      {
        "@type": "ListItem",
        "position": {{ forloop.index }},
        "url": "{{ post.url | absolute_url }}",
        "name": "{{ post.title | escape }}"
      }{%- unless forloop.last -%},{%- endunless -%}
      {%- endfor -%}
    ]
  },
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {"@type": "ListItem", "position": 1, "name": "Home", "item": "{{ '/' | absolute_url }}"},
      {"@type": "ListItem", "position": 2, "name": "{{ page.title }}"}
    ]
  }
}
</script>
