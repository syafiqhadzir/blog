---
layout: default
---

{%- comment -%}
  Enhanced Archive with Search
  - Real-time search filtering (progressive enhancement)
  - Year grouping with collapsible sections
  - Result counter
  - Keyboard shortcut (/)
  - Empty state handling
{%- endcomment -%}

<section class="archive-page" aria-label="Post archive">
    <header class="archive-header">
        <h1 id="archive-title">{{ page.title }}</h1>
        {%- if page.description -%}
        <p class="archive-description">{{ page.description }}</p>
        {%- endif -%}
        <p class="archive-stats">
            <span class="stat-total">{{ site.posts | size }}</span> articles published since 2022.
        </p>
    </header>

    <!-- Search Box -->
    <div class="archive-search" role="search">
        <label for="archive-search-input" class="sr-only">Search articles</label>
        <input type="search"
               id="archive-search-input"
               class="archive-search-input"
               placeholder="üîç Search articles..."
               aria-label="Search articles"
               aria-describedby="search-hint"
               on="input-debounced:AMP.setState({ archiveSearchQuery: event.value })"
               [value]="archiveSearchQuery || ''"
               autocomplete="off">
        <span class="search-hint" id="search-hint" aria-hidden="true" [hidden]="archiveSearchQuery">
            <kbd>/</kbd> to focus
        </span>
    </div>

    <!-- Result Counter -->
    <div class="archive-results" aria-live="polite" aria-atomic="true" [hidden]="!archiveSearchQuery">
        <span>Search results for <strong [text]="archiveSearchQuery"></strong></span>
    </div>

    {{ content }}

    <!-- AMP State for Progressive Disclosure -->
    <amp-state id="showAllYears">
        <script type="application/json">
            false
        </script>
    </amp-state>

    <!-- Posts by Year -->
    <div class="archive-years" id="archive-list">
        {%- assign posts_by_year = site.posts | group_by_exp: "post", "post.date | date: '%Y'" -%}
        {%- assign initial_years = 3 -%}
        {%- for year in posts_by_year -%}
        {%- assign year_index = forloop.index0 -%}
        {%- capture year_content -%}
            {%- for post in year.items -%}
                {{ post.title | downcase | replace: '\', '\\\\' | replace: '"', '&quot;' | replace: "'", "\\'" }} {{ post.tags | join: ' ' | downcase | replace: '\', '\\\\' | replace: '"', '&quot;' | replace: "'", "\\'" }}
            {%- endfor -%}
        {%- endcapture -%}
        <details class="year-group" {% if year_index < initial_years %}open{% endif %}
                 data-year="{{ year.name }}"
                 data-year-index="{{ year_index }}"
                 {% if year_index >= initial_years %}hidden{% endif %}
                 [hidden]="({{ year_index }} >= {{ initial_years }} && !showAllYears && !archiveSearchQuery) || (archiveSearchQuery && '{{ year_content | strip_newlines }}'.indexOf(archiveSearchQuery.toLowerCase()) == -1)">
            <summary class="year-header">
                <span class="year-chevron" aria-hidden="true"></span>
                <span class="year-label">{{ year.name }}</span>
                <span class="year-count" data-original="{{ year.items | size }}">{{ year.items | size }} articles</span>
            </summary>
            <ul class="archive-posts" role="list">
                {%- for post in year.items -%}
                <li class="archive-post-item"
                    role="listitem"
                    [hidden]="archiveSearchQuery && '{{ post.title | downcase | replace: '\', '\\\\' | replace: '"', '&quot;' | replace: "'", "\\'" }} {{ post.tags | join: ' ' | downcase | replace: '\', '\\\\' | replace: '"', '&quot;' | replace: "'", "\\'" }}'.indexOf(archiveSearchQuery.toLowerCase()) == -1">
                    <time class="archive-date" datetime="{{ post.date | date_to_xmlschema }}">
                        {{ post.date | date: "%d %b" }}
                    </time>
                    <a class="archive-link" href="{{ post.url | relative_url }}">
                        {{ post.title }}
                    </a>
                    {%- if post.tags.size > 0 -%}
                    <span class="archive-tags">
                        {%- for tag in post.tags limit: 2 -%}
                        <span class="archive-tag">{{ tag }}</span>
                        {%- endfor -%}
                    </span>
                    {%- endif -%}
                </li>
                {%- endfor -%}
            </ul>
        </details>
        {%- endfor -%}

        {%- if posts_by_year.size > initial_years -%}
        <div class="archive-load-more" [hidden]="showAllYears || archiveSearchQuery">
            <button type="button"
                    class="load-more-years"
                    on="tap:AMP.setState({ showAllYears: true })">
                Load {{ posts_by_year.size | minus: initial_years }} more years
            </button>
        </div>
        {%- endif -%}
    </div>

    <!-- Empty State -->
    <div class="archive-empty" id="no-results" [hidden]="!archiveSearchQuery || archiveSearchQuery.length === 0 || '{{ site.posts | map: 'title' | join: ' ' | downcase | replace: '\', '\\\\' | replace: '"', '&quot;' | replace: "'", "\\'" }} {{ site.posts | map: 'tags' | join: ' ' | downcase | replace: '\', '\\\\' | replace: '"', '&quot;' | replace: "'", "\\'" }}'.indexOf(archiveSearchQuery.toLowerCase()) != -1">
        <div class="empty-icon" aria-hidden="true">üîç</div>
        <p>No articles found matching "<strong [text]="archiveSearchQuery"></strong>"</p>
        <p class="empty-hint">Try different keywords or <button type="button" class="clear-link" on="tap:AMP.setState({ archiveSearchQuery: '' })">clear the search</button></p>
    </div>
</section>




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "CollectionPage",
  "name": "{{ page.title }}",
  "description": "{{ page.description | default: 'Browse all blog posts' }}",
  "url": "{{ page.url | absolute_url }}",
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": {{ site.posts | size }},
    "itemListElement": [
      {%- for post in site.posts limit:10 -%}
      {
        "@type": "ListItem",
        "position": {{ forloop.index }},
        "url": "{{ post.url | absolute_url }}",
        "name": "{{ post.title | escape }}"
      }{%- unless forloop.last -%},{%- endunless -%}
      {%- endfor -%}
    ]
  },
  "breadcrumb": {
    "@type": "BreadcrumbList",
    "itemListElement": [
      {"@type": "ListItem", "position": 1, "name": "Home", "item": "{{ '/' | absolute_url }}"},
      {"@type": "ListItem", "position": 2, "name": "{{ page.title }}"}
    ]
  }
}
</script>
