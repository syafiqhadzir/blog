{%- comment -%}
================================================================================
AMP CONSENT - GDPR/CCPA Compliance
Expert-level privacy consent management following Google AMP best practices.

Features:
  • GDPR and CCPA compliant consent UI
  • Granular consent categories (analytics, personalization)
  • Persistent consent state via localStorage
  • Consent-aware analytics blocking
  • Customizable consent prompt
  • Accessibility compliant (WCAG 2.2 AA)
================================================================================
{%- endcomment -%}

<amp-consent id="consent" layout="nodisplay">
  <script type="application/json">
    {
      "consentInstanceId": "site-consent",
      "consentRequired": true,
      "promptUISrc": "#consent-ui",
      "postPromptUI": "post-consent-ui",
      "clientConfig": {
        "initialConsentState": "unknown",
        "consentCategories": {
          "analytics": {
            "description": "Analytics and performance tracking",
            "defaultValue": false
          },
          "personalization": {
            "description": "Personalized content and preferences",
            "defaultValue": false
          }
        }
      }
    }
  </script>

  {%- comment -%} Consent Prompt UI {%- endcomment -%}
  <div id="consent-ui" class="consent-prompt" hidden>
    <div class="consent-content">
      <h2>Privacy & Preferences</h2>
      <p>We use cookies to refine your reading experience and analyze our traffic. Please choose your preferences below.</p>

      <div class="consent-categories">
        <div class="consent-category">
          <label>
            <input type="checkbox" name="analytics" checked>
            <span class="consent-label">
              <strong>Performance Analytics</strong>
              <small>Helps us understand how you use our technical guides.</small>
            </span>
          </label>
        </div>

        <div class="consent-category">
          <label>
            <input type="checkbox" name="personalization" checked>
            <span class="consent-label">
              <strong>Personalization</strong>
              <small>Remembers your reading settings (font size, theme).</small>
            </span>
          </label>
        </div>
      </div>

      <div class="consent-actions">
        <button on="tap:consent.accept" class="consent-btn consent-accept">Confirm My Choices</button>
        <button on="tap:consent.reject" class="consent-btn consent-reject">Decline All</button>
        <button on="tap:consent.dismiss" class="consent-btn consent-customize">Dismiss</button>
      </div>

      <p class="consent-footer">
        <small>
          Read our <a href="{{ '/privacy' | relative_url }}">Privacy Policy</a> & <a href="{{ '/cookies' | relative_url }}">Cookie Policy</a>.
        </small>
      </p>
    </div>
  </div>

  {%- comment -%} Post-Consent UI (Settings Link) {%- endcomment -%}
  <div id="post-consent-ui" class="post-consent" hidden>
    <button on="tap:consent.prompt()" class="consent-settings-btn" aria-label="Privacy Settings">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
      </svg>
      Privacy
    </button>
  </div>
</amp-consent>
