{%- if site.google_analytics or jekyll.environment == 'production' -%}
{%- comment -%}
================================================================================
GOOGLE ANALYTICS 4 (GA4) - EXPERT AMP CONFIGURATION
Expert-level implementation following Google AMP & GA4 best practices:
  - Valid JSON structure with proper Liquid variable handling
  - GA4 gtag type with correct configuration
  - Enhanced event tracking with proper parameters
  - Comprehensive user engagement metrics
  - Removed deprecated triggers requiring experiments
  - Video triggers with proper selectors
  - GDPR-compliant with data_credentials
  - Transport-optimized for reliability
================================================================================
{%- endcomment -%}
{%- assign ga_id = site.google_analytics | default: 'G-TYLK1PCZPF' -%}
{%- assign page_type = page.layout | default: 'page' -%}
{%- assign content_category = page.categories | first | default: page.tags | first | default: 'general' -%}
{%- assign post_tags = page.tags | join: ',' | default: '' -%}
{%- assign site_domain = site.url | replace: 'https://', '' | replace: 'http://', '' -%}
<amp-analytics type="gtag" data-credentials="include">
<script type="application/json">
{
  "vars": {
    "gtag_id": "{{ ga_id }}",
    "config": {
      "{{ ga_id }}": {
        "groups": "default",
        "page_type": "{{ page_type }}",
        "content_category": "{{ content_category }}",
        "post_tags": "{{ post_tags }}",
        "amp_version": true,
        "send_page_view": true,
        "cookie_flags": "SameSite=None;Secure"
      }
    }
  },
  "triggers": {
    "trackPageview": {
      "on": "visible",
      "request": "pageview"
    },
    "scrollTracking": {
      "on": "scroll",
      "scrollSpec": {
        "verticalBoundaries": [10, 25, 50, 75, 90, 100]
      },
      "request": "event",
      "vars": {
        "event_name": "scroll",
        "event_category": "engagement",
        "event_label": "depth",
        "value": "${verticalScrollBoundary}"
      }
    },
    "clickTracking": {
      "on": "click",
      "selector": "a:not([href^='mailto:']):not([href^='tel:'])",
      "request": "event",
      "vars": {
        "event_name": "click",
        "event_category": "engagement",
        "event_label": "${href}",
        "link_url": "${href}",
        "link_text": "${text}"
      }
    },
    "navigationTracking": {
      "on": "click",
      "selector": "nav a, .nav-links a, .navbar a",
      "request": "event",
      "vars": {
        "event_name": "navigation",
        "event_category": "navigation",
        "event_label": "${text}",
        "link_url": "${href}"
      }
    },
    "socialShareTracking": {
      "on": "amp-social-share-click",
      "request": "event",
      "vars": {
        "event_name": "share",
        "event_category": "social",
        "event_label": "${type}",
        "method": "${type}"
      }
    },
    "engagementTimer": {
      "on": "timer",
      "timerSpec": {
        "interval": 30,
        "maxTimerLength": 600
      },
      "request": "event",
      "vars": {
        "event_name": "user_engagement",
        "event_category": "engagement",
        "event_label": "time_on_page",
        "value": "${timerDuration}"
      }
    }
  }
}
</script>
</amp-analytics>
{%- endif -%}
